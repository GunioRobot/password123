/*
 * jQuery password123: iPhone Style Passwords Plugin - v1.2 - 9/28/2010
 * http://timmywillison.com/samples/password123/
 * 
 * Copyright (c) 2010 timmy willison
 * Dual licensed under the MIT and GPL licences.
 * http://timmywillison.com/licence/
 */
(function($,window,document,undefined){var last,opts={character:"&#8226;",delay:2000,prefix:"iField",placeholder:true,placeholderClass:"place",maskPlaceholder:false};$.event.special.textchange={setup:function(data,namespaces){$(this).bind("keyup.textchange",$.event.special.textchange.handler);$(this).bind("cut.textchange paste.textchange input.textchange",$.event.special.textchange.delayedHandler)},teardown:function(namespaces){$(this).unbind(".textchange")},handler:function(event){$.event.special.textchange.triggerIfChanged($(this))},delayedHandler:function(event){var $element=$(this);setTimeout(function(){$.event.special.textchange.triggerIfChanged($element)},25)},triggerIfChanged:function($element){var v=$element.val(),encodedCharacter=$("<div>"+opts.character+"</div>").text();if($element.val()!==$element.data("lastValue")){if(v.length>1&&v.indexOf(encodedCharacter)===-1){v=v.substr(0,v.length-1);$element.data("value",v).prev("input").val(v)}$element.trigger("textchange",$element.data("lastValue"));$element.data("lastValue",$element.val())}}};$.fn.textchange=function(fn){return fn?this.bind("textchange",fn):this.trigger("textchange")};if($.attrFn){$.attrFn.textchange=true}function getCursorPosition(field){if(field!=null){if(document.selection){field.focus();var sel=document.selection.createRange();sel.moveStart("character",-field.value.length);return sel.text.length}else{if(field.selectionStart||field.selectionStart=="0"){return field.selectionStart}else{return -1}}}}function setCursorPosition(field,pos){if(field!=null){if(field.createTextRange){var range=field.createTextRange();range.move("character",pos);range.select()}else{if(field.selectionStart){field.focus();field.setSelectionRange(pos,pos)}else{field.focus()}}}}function replaceFields(f){var fields=[];$(f).each(function(i,item){var $field=$(item),field_id=opts.prefix+i,place=$field.attr("placeholder")||undefined,value=$field.attr("value")||place||"";$('<input type="text"/>').attr({"class":opts.placeholder&&place!==undefined?$field.attr("class")+" "+opts.placeholderClass:$field.attr("class"),id:field_id,value:value}).insertAfter($field).data("value",$field.attr("value")||"").data("placeholder",place);fields.push(document.getElementById(field_id));$('<input type="hidden"/>').attr({name:$field.attr("name"),id:$field.attr("id"),"class":$field.attr("class")}).replaceAll($field).val(value)});return $(fields)}function letterChange(){var $field=$(this),fv=$field.val();if(fv.length>$field.data("value").length){$field.data("value",fieldChange($field))}else{if(fv.length<$field.data("value").length){window.clearTimeout(last);var hidden=$field.prev("input"),old=hidden.val(),newVal;if(fv.length<old.length-1){newVal=old.substr(0,fv.length)}else{var cp=getCursorPosition($field[0]);newVal=old.length>cp+1&&cp>-1?old.slice(0,cp).concat(old.slice(cp+1)):old.slice(0,cp)}$field.data("value",fv).prev("input").val(newVal)}}}function fieldChange($field){window.clearTimeout(last);var fv=$field.val(),len=fv.length,hidden=$field.prev("input"),old=hidden.val(),cp=getCursorPosition($field[0]),encodedCharacter=$("<div>"+opts.character+"</div>").text(),newVal;newVal=old.length>cp+1&&cp>-1?old.substr(0,cp-1)+fv.charAt(cp-1)+old.substr(cp-1):old+fv.charAt(len-1);hidden.val(newVal);if(len>1){for(var i=0;i<len-1;i++){fv=fv.replace(fv.charAt(i),encodedCharacter)}$field.val(fv)}if(len>0){last=setTimeout(function(){cp=getCursorPosition($field[0]);fv=$field.val();fv=fv.replace(fv.charAt(len-1),encodedCharacter);$field.val(fv).data("value",fv);if(cp!=len){setCursorPosition($field[0],cp)}},opts.delay)}if(cp!=len){setCursorPosition($field[0],cp)}return fv}function bindPlaceholder($fields){$fields.each(function(i){var $f=$(this),hidden=$f.prev("input"),place=$f.data("placeholder");if(place!==undefined){$f.focus(function(){if(hidden.val()===place){$f.val("").removeClass(opts.placeholderClass);hidden.val("")}}).blur(function(){if(place!==undefined&&$f.val()===""){$f.val(place).addClass(opts.placeholderClass).prev("input").val(place).end();if(opts.maskPlaceholder){$f.keyup()}}})}else{$f.keyup()}});if(opts.maskPlaceholder){$fields.keyup()}}$.fn.password123=function(settings){opts=jQuery.extend(opts,settings);var $fields=replaceFields(this);$fields.textchange(letterChange);if(opts.placeholder){bindPlaceholder($fields)}return $fields}})(jQuery,this,document);